doctype html
html(lang="en", class="h-100", data-bs-theme="auto")
  head
    meta(charset="utf-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    meta(name="description", content="")
    meta(name="author", content="Mark Otto, Jacob Thornton, and Bootstrap contributors")
    meta(name="generator", content="Astro v5.13.2")
    title Sakila Movies

    link(rel="canonical", href="https://getbootstrap.com/docs/5.3/examples/cover/")

    //- Bootstrap CSS
    link(
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css",
      rel="stylesheet")

    link(rel="apple-touch-icon", sizes="180x180", href="/docs/5.3/assets/img/favicons/apple-touch-icon.png")
    link(rel="icon", type="image/png", sizes="32x32", href="/docs/5.3/assets/img/favicons/favicon-32x32.png")
    link(rel="icon", type="image/png", sizes="16x16", href="/docs/5.3/assets/img/favicons/favicon-16x16.png")
    link(rel="manifest", href="/docs/5.3/assets/img/favicons/manifest.json")
    link(rel="mask-icon", href="/docs/5.3/assets/img/favicons/safari-pinned-tab.svg", color="#712cf9")
    link(rel="icon", href="/docs/5.3/assets/img/favicons/favicon.ico")
    meta(name="theme-color", content="#712cf9")

    link(href="cover.css" rel="stylesheet")

    style.
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }
      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
      .b-example-divider {
        width: 100%;
        height: 3rem;
        background-color: #0000001a;
        border: solid rgba(0, 0, 0, 0.15);
        border-width: 1px 0;
        box-shadow: inset 0 .5em 1.5em #0000001a, inset 0 .125em .5em #00000026;
      }
      .b-example-vr {
        flex-shrink: 0;
        width: 1.5rem;
        height: 100vh;
      }
      .bi {
        vertical-align: -0.125em;
        fill: currentColor;
      }
      .nav-scroller {
        position: relative;
        z-index: 2;
        height: 2.75rem;
        overflow-y: hidden;
      }
      .nav-scroller .nav {
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        margin-top: -1px;
        overflow-x: auto;
        text-align: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }
      .btn-bd-primary {
        --bd-violet-bg: #712cf9;
        --bd-violet-rgb: 112.520718, 44.062154, 249.437846;
        --bs-btn-font-weight: 600;
        --bs-btn-color: var(--bs-white);
        --bs-btn-bg: var(--bd-violet-bg);
        --bs-btn-border-color: var(--bd-violet-bg);
        --bs-btn-hover-color: var(--bs-white);
        --bs-btn-hover-bg: #6528e0;
        --bs-btn-hover-border-color: #6528e0;
        --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);
        --bs-btn-active-color: var(--bs-btn-hover-color);
        --bs-btn-active-bg: #5a23c8;
        --bs-btn-active-border-color: #5a23c8;
      }
      .bd-mode-toggle {
        z-index: 1500;
      }
      .bd-mode-toggle .bi {
        width: 1em;
        height: 1em;
      }
      .bd-mode-toggle .dropdown-menu .active .bi {
        display: block !important;
      }
      .nav-link {
        color: #ffffff !important;
      }
      .nav-link.active {
        color: #ffffffff !important;
      }
      .nav-link:hover {
        color: #ff0000ff !important;
      }
      

  body(class="d-flex h-100 text-center text-bg-dark")
    div.cover-container.d-flex.w-100.h-100.p-3.mx-auto.flex-column
      header.mb-auto
        div
          h3.float-md-start.mb-0 Sakila Movies
          nav.nav.nav-masthead.justify-content-center.float-md-end
            a.nav-link.fw-bold.py-1.px-0.active(href="/", aria-current="page") Home 
            a.nav-link.fw-bold.py-1.px-0.ms-3(href="/movies") Movies 
            a.nav-link.fw-bold.py-1.px-0.ms-3(href="/login") Log in 

      .container.my-5
        .row.justify-content-center
          .col-md-6
            select#movieLimit.form-select
              option(value="0") Show all
              option(value="4") Show 4
              option(value="8") Show 8
              option(value="16") Show 16
              option(value="32") Show 32
              option(value="64") Show 64
          .col-md-6
            input#movieSearch.form-control(type="text", placeholder="Search movies...")
            
      .container
        .row.row-cols-1.row-cols-sm-2.row-cols-md-3.row-cols-lg-4.g-4
          each movie in movies
            .col
              .card.h-100
                img.card-img-top(src="/images/Bombardiro_Crocodillo.jpg", alt=movie.title)
                .card-body
                  h5.card-title= movie.title
                .card-footer.text-center
                  button.btn.btn-primary(type="button", data-bs-toggle="modal", data-bs-target=`#movieModal-${movie.film_id}`)
                    View Details

              // Modal per film
              .modal.fade(id=`movieModal-${movie.film_id}`, tabindex="-1")
                .modal-dialog
                  .modal-content.text-bg-dark.text-white
                    .modal-header
                      h5.modal-title= movie.title
                      button.btn-close(type="button", data-bs-dismiss="modal", aria-label="Close")
                    .modal-body.text-start
                      if movie.release_year
                        p Released: #{movie.release_year}
                      if movie.description
                        p= movie.description
                      else
                        p No description available.
                    .modal-footer
                      button.btn.btn-secondary(type="button", data-bs-dismiss="modal") Close

      footer.mt-auto.text-white-50
        p - Made by Abderabbouh -

      //- Bootstrap JS bundle
      script(
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js",
        crossorigin="anonymous"
      )

      //- Custom JS Searchbar
      script.
        document.getElementById('movieSearch').addEventListener('input', function() {
          const query = this.value.toLowerCase();
          const cards = document.querySelectorAll('.card');
          cards.forEach(card => {
            const title = card.querySelector('.card-title').textContent.toLowerCase();
            if (title.includes(query)) {
              card.parentElement.style.display = '';
            } else {
              card.parentElement.style.display = 'none';
            }
          });      
        });

      //- Custom JS Filter System
      script.
        const searchInput = document.getElementById('movieSearch');
        const limitSelect = document.getElementById('movieLimit');
        const cards = document.querySelectorAll('.card');
        const cardCols = Array.from(cards).map(c => c.parentElement);
        function filterMovies() {
          const query = searchInput.value.toLowerCase();
          const limit = parseInt(limitSelect.value, 10);
          let shown = 0;
          cardCols.forEach(col => {
            const title = col.querySelector('.card-title').textContent.toLowerCase();
            if (title.includes(query)) {
              if (limit === 0 || shown < limit) {
                col.style.display = 'block';
                shown++;
              } else {
                col.style.display = 'none';
              }
            } else {
              col.style.display = 'none';
            }
          });
        }
        searchInput.addEventListener('input', filterMovies);
        limitSelect.addEventListener('change', filterMovies);
        filterMovies(); // initieel